{% extends "layout.html" %}


{% block content %}

<div class="row topRow">
  <div class="col-md-10 col-md-offset-1">
    <ul class="nav nav-tabs">
      <li {% if not adv_search %} class="active"{% endif %}><a href="#keyword" data-toggle="tab">Keyword</a></li>
      <li {% if adv_search %} class="active"{% endif %}><a href="#advanced" data-toggle="tab">Advanced</a></li>
    </ul>
  </div>
</div>

<br>

<div class="tab-content">
  <div class="tab-pane {% if not adv_search %} active{% endif %}" id="keyword">
    <form  method="get" name="search">
        <div class="row">
          <div class="col-md-10 col-md-offset-1">
            <div class="form-group">
              <input name="keyword" class="form-control" type="text" value="{{ request.args.get('keyword', '') }}" placeholder="Keyword search term">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-1 col-md-offset-10">
              <div class="form-group">
                <input type="submit" class="btn btn-default" value="Search">
              </div>
          </div>
        </div>
    </form>
  </div>

{% macro search_field(field_name, placeholder=False) -%}
  {% if not placeholder -%}
    {% set placeholder = 'Enter ' + field_name -%}
  {% endif -%}
  {% if kwargs.pop('disabled', False) -%}
    {% set is_disabled = 'disabled' -%}
  {% endif -%}
    <label for="{{field_name}}_adv" class="col-sm-2 control-label">{{field_name|capitalize}}</label>
    <div class="col-sm-4">
      <input class="form-control" name="{{field_name|to_arg}}"
             id="{{field_name|to_arg}}_adv" value="{{ request.args.get(field_name|to_arg, '') }}"
             placeholder="{{placeholder}}" {{is_disabled}}>
    </div>
{%- endmacro %}

  <div class="tab-pane form-horizontal {% if adv_search %} active{% endif %}" id="advanced">
    <div class="row">
      <div class="col-md-10">
        <form  method="get" name="search">
          <div class="form-group">
            {{ search_field('keyword') }}
            {{ search_field('title', disabled=True) }}
          </div>

          <div class="form-group">
            {{ search_field('period', disabled=True) }}
            {{ search_field('address') }}
          </div>

          <div class="form-group">
            {{ search_field('building type', disabled=True) }}
            {{ search_field('creator') }}
          </div>

          <div class="form-group">
            {{ search_field('style', disabled=True) }}
            {{ search_field('description', disabled=True) }}
          </div>

          <div class="form-group">
            {{ search_field('construction from', placeholder='Enter year (yyyy)') }}
            {{ search_field('construction to', placeholder='Enter year (yyyy)') }}
          </div>

          <div class="form-group">
            <div class="col-sm-2 col-md-offset-8">
              <input type="submit" class="btn btn-default" value="Search">
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div><!-- //tab-content -->


<div class="row">
    <div class="col-md-3 facets">
{% set facets_to_display = [
    ('Suburb', 'addresses.suburb', 'title'),
    ('State', 'state', 'upper'),
    ('Category Group', 'categories.group', 'title'),
    ('Category', 'categories.name', 'title'),
    ('Architect', 'architects.raw', 'title')
] -%}
        {% for title, facet, case in facets_to_display %}
      <div class="panel panel-default">
        <div class="panel-heading">{{title}}</div>
        <div class="panel-body">
          <ol>
            {% if facet in active_facets %}
              <li>
                <strong>{{ active_facets[facet]|apply_filter(case) }}
                  <a href="{{ url_for_custom_params('search', **{facet: None}) }}">[X]</a>
                </strong>
              </li>
            {% else %}
              {% for term in facets[facet].terms %}
                <li>
                  <a href="{{ url_for_custom_params('search', **{facet: term.term}) }}" data-field="{{facet}}"
                     data-value="{{term.term}}">{{ term.term|apply_filter(case) }}</a>
                     ({{ term.count }})
                </li>
              {% endfor %}
            {% endif %}
          </ol>
          </div>
      </div>
        {% endfor %}
    </div>


    <div class="col-md-8 results">

        {{ pagination.info|safe }}
        <ol>
        {% for hit in results %}
        <li>
                <b><a href="{{ url_for('get_record', id=hit._id) }}">[{{ hit._source.state }}] {{ hit._source.name|title }}</a></b>
                 - <a href="{{ hit._source.url }}">Source record</a>
                 <br>
                 {% with address = hit._source.addresses|first %}
                    {% if address %}
                        <div class="address">{{address.lga_name|title if address.lga_name}}, {{address.state}}{{', ' ~ address.postcode if address.postcode}}</div>
                    {% endif %}
                 {% endwith %}

        </li>
        {% endfor %}
        </ol>

        {{ pagination.links|safe }}
    </div>
</div>


<script>
// $(".facets a").on("click", function(e) {
//   console.log(e);
//   console.log(this);
//   debugger;
//   $(this).data('field');
// });

</script>


{% endblock %}